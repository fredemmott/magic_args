---
title: Changes - v0.4
parent: Changes
---

# Changes - v0.4

This page summarizes the most visible changes since v0.2

## Breaking changes

Most users should:

- move to the `MAGIC_ARGS_MAIN(...)` macro
- move version/description/examples to `static constexpr` on the args type; they remain optional
- move parsing_traits to a type alias on the args type; this remains optional

For example:

```c++
#include <magic_args/magic_args.hpp>

struct MyArgs {
    std::string foo;
    std::string bar;
    
    // These are all optional:
    using parsing_traits = magic_args::powershell_style_parsing_traits;
    static constexpr auto description = "do stuff";
    static constexpr auto version = "MyApp v1.2.3";
    static constexpr auto examples = {
        "myapp --foo herp",
        "myapp --bar derp",
    };
};

MAGIC_ARGS_MAIN(const MyArgs& args) {
  // Your code here, e.g.:
  magic_args::dump(args);
  return 0;
}
```

The macro will take care of error handling and [various encoding issues](../features/encoding.md), especially on Windows.

Full details:

- `powershell_style_parsing_traits` now correctly sets `value_separator` to `:`; this means that if you were passing `-Foo=VALUE`, you must now pass `-Foo:VALUE`. `-Foo VALUE` remains supported
  - to revert to the previous behavior:
    ```c++
    struct MyArgs {
      struct parsing_traits : magic_args::powershell_style_parsing_traits {
        static constexpr auto value_separator = "=";
      };
      // ... your args here ...
    };
    MAGIC_ARGS_MAIN(const MyArgs& args) { ... }
    ```
- GCC 13 is no longer supported due to C++23 features
  - If you are using Ubuntu 24.04 LTS, `g++-14` is also available: `apt install -y g++-14`, then use `CMAKE_CXX_COMPILER=g++-14`
- `magic_args::parse()` no longer directly accepts `int argc, char** argv` parameters
  - For maximum portability and accuracy, use `parse(make_utf8_argv(argc, argv))`
  - If you are happy to assume the input is UTF-8, use `parse(std::views::counted(argv, argc))`
- `magic_args::incomplete_parse_reason_t` is now a variant, not an enum; the specific parse reasons are now structs that contain additional information, e.g. which argument is responsible
  - If you are on Windows, you can also pass a wide argv from `wmain()` to `make_utf8_argv()`, to avoid code page issues
  - To handle all possibilities with completeness checks, use `std::visit()` with the overload pattern
- `flag` now has `mValue` as the first member, for consistency with the other explicit argument definitions; if you
  are using initializer lists with `flag`, you will need to add an extra `false`
- Text for various end-user messages (e.g. `--help`) has been added, extended, or clarified
- If you are specifying traits (e.g. `verbatim_names<>` or `powershell_style_parsing_traits`), these must now be specified as a `parsing_traits` member of the arguments type
  - For example, replace `magic_args::parse<MyArgsType, powershell_style_parsing_traits>` with `magic_args::parse<powershell_style_parsing_traits, MyArgsType>`
  - This is for consistency with new variadic functionality, like `parse_subcommands()`; C++23 limitations make following the existing convention impractical
- Custom types: `from_string_argument()` must now return an `std::expected<void, invalid_argument_value_t>` instead of just `void`
- If you are creating your own parsing_traits, the normalization functions now:
  - must be constexpr
  - take the argument name (which is explicitly convertible to an `std::string_view`; e.g. it may be an `std::array<char, N>`) as the template parameter
  - return something explicitly convertible to `std::string_view`
- Win32: the `MAGIC_ARGS_ENABLE_WINDOWS_EXTENSIONS` macro now only affects the single-header version of `magic_args`; include `<magic_args/windows.hpp>` instead. If you need to support both, use `__has_include()`, or check for `MAGIC_ARGS_HAVE_WINDOWS_EXTENSIONS` after including `<magic_args/magic_args.hpp>`
- Win32: `magic_args::attach_to_parent_terminal()` has been moved to a `win32` sub-namespace; e.g. it can be called as `magic_args::win32::attach_to_parent_terminal()`
- Win32: overloads for `magic_args::parse()` are no longer provided; use the new `magic_args::make_utf8_argv()` function instead. This is because v0.4 contains significantly expanded functionality, and the number of required overloads would have expanded significantly. This change also allows clearer identification and handling of encoding errors

## New features

- added support for subcommands, including multi-call (busybox-style) subcommands
- added `magic_args::parse_silent()`, which does not write to `stdout` or `stderr`
- added `magic_errors::is_error(...)` to concisely identify if an unexpected result is an error (e.g. `invalid_argument_value_t`) or a non-error (e.g. `help_requested_t`)
- when using GNU-style parsing (default), multiple single-argument flags can be combined, e.g. `-abc` is equivalent to `-a -b -c`
- added 'counted flags' with optional values, e.g, with `magic_args::counted_flag verbose { .mShortName = "v" };`:
  - `--verbose` or `-v` set the value to 1
  - `--verbose=3` or `-vvv` set the value to 3
  - `--verbose=3 -vv` sets the value to 5
- added support for enums, if [`<magic_enum/magic_enum.hpp>`](https://github.com/Neargye/magic_enum) is available
- added `<magic_args/iconv.hpp>`, adding an implementation of `make_utf8_argv(argc, argv)` for Linux and macOS
- `--help` now shows the default values unless default-initialized, or the empty string. Default values are always shown for enums, even if default-initialized
  - to support this for custom types, implement `formattable_argument_value(const MyCustomType& value)` in the same namespace as your custom type. It must return an `std::formattable<>`

## Other improvements

- argument normalization is now compile-time (`constexpr`)
- argv parameters can now be passed as any random-access-range containing elements that are convertible to `std::string_view`
- more consistent output handling: the 'loud' functions (e.g. `parse()`) now wrap the 'silent' functions (e.g. `parse_silent()`), and produce user-visible output as needed based on the returned value